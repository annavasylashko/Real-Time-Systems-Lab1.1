<!DOCTYPE html>
<html>

<head>
  <title>Vasylashko | Lab 1</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
  <script src="./rsg.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.css" />
  <link rel="stylesheet" href="./style.css" />
</head>

<body onload="return fillChart()">
  <form onsubmit="return fillChart()">
    <label for="garmonic">Число гармонік в сигналі:</label><br />
    <input type="number" id="garmonic" name="garmonic" value="10" /><br />

    <label for="limitfrequency">Гранична частота:</label><br />
    <input type="number" id="limitfrequency" name="limitfrequency" value="900" /><br />

    <label for="discretenumber">Кількість дискретних відліків :</label><br />
    <input type="number" id="discretenumber" name="discretenumber" value="256" /><br /><br />
    <input id="submit" type="submit" value="Submit" />
  </form>

  <p id="average">Математичне сподівання:</p>
  <p id="dispercy">Дисперсія:</p>

  <canvas id="signals"></canvas>
  <canvas id="dft"></canvas>
  <canvas id="fft"></canvas>

  <script>
    function fillChart() {
      var ctxSignals = document.getElementById("signals");
      var ctxDFT = document.getElementById("dft");
      var ctxFFT = document.getElementById("fft");

      var n = document.getElementById("garmonic").value;
      var wl = document.getElementById("limitfrequency").value;
      var N = document.getElementById("discretenumber").value;

      var pAverage = document.getElementById("average");
      var pDispercy = document.getElementById("dispercy");

      var signals = generateRandomSignals(n, wl, N);
      var dfts = dft(signals.slice()).map((complexNumber) => Math.sqrt(complexNumber.real ** 2 + complexNumber.imag ** 2))
      var ffts = fft(signals.slice()).map((complexNumber) => Math.sqrt(complexNumber.real ** 2 + complexNumber.imag ** 2))

      console.log(dfts)
      console.log(ffts)

      pAverage.innerHTML = `Математичне сподівання: ${average(signals)}`;
      pDispercy.innerHTML = `Дисперсія: ${dispercy(signals)}`;

      var signalsXDataset = {
        label: "x(t)",
        data: signals,
        pointRadius: 0,
        backgroundColor: ["rgba(0, 122, 255, 0.2)"],
        borderColor: ["rgb(0, 122, 255)"],
        borderWidth: 1,
      };

      var dftDataset = {
        label: "Дискретне перетворення Фур'є",
        data: dfts,
        pointRadius: 0,
        backgroundColor: ["rgba(0, 122, 255, 0.2)"],
        borderColor: ["rgb(0, 122, 255)"],
        borderWidth: 1,
      }

      var fftDataset = {
        label: "Швидке перетворення Фур'є",
        data: ffts,
        pointRadius: 0,
        backgroundColor: ["rgba(0, 122, 255, 0.2)"],
        borderColor: ["rgb(0, 122, 255)"],
        borderWidth: 1,
      }

      var labels = signals.map((val, index) => String(index));
      var dftLabels = signals.map((val, index) => String(index))

      var signalsData = {
        labels: labels,
        datasets: [signalsXDataset],
      };

      var dftData = {
        labels: dftLabels,
        datasets: [dftDataset],
      };

      var fftData = {
        labels: dftLabels,
        datasets: [fftDataset],
      };

      var options = {
        scales: {
          xAxes: [
            {
              scaleLabel: {
                display: true,
                labelString: "t",
              },
            },
          ],
          yAxes: [
            {
              scaleLabel: {
                display: true,
                labelString: "x",
              },
            },
          ],
        },
      };

      var dtfOptions = {
        scales: {
          xAxes: [
            {
              scaleLabel: {
                display: true,
                labelString: "",
              },
            },
          ],
          yAxes: [
            {
              scaleLabel: {
                display: true,
                labelString: "",
              },
            },
          ],
        },
      };

      var fftOptions = {
        scales: {
          xAxes: [
            {
              scaleLabel: {
                display: true,
                labelString: "",
              },
            },
          ],
          yAxes: [
            {
              scaleLabel: {
                display: true,
                labelString: "",
              },
            },
          ],
        },
      };

      var signalsChart = new Chart(ctxSignals, {
        type: "line",
        data: signalsData,
        options: options,
      });

      var dftChart = new Chart(ctxDFT, {
        type: "line",
        data: dftData,
        options: dtfOptions,
      });

      var fftChart = new Chart(ctxFFT, {
        type: "line",
        data: fftData,
        options: fftOptions,
      });

      return false;
    }
  </script>
</body>

</html>